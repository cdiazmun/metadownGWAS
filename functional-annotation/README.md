
# Functional annotation
If you got this far, you already have a bunch of variants (SNPs and/or INDELs) that are putatively associated to the trait under study. Now we need to give them a biological meaning. To do that, we need to gather the information about the genomic context in which every variant is placed. We can do that with the `SNP2GENE` function of `FUMA`, making use of its web platform. 

- [FUMA](https://doi.org/10.1038/s41467-017-01261-5) - [website](https://fuma.ctglab.nl/)

There is a very nice documentation to understand all the output one can obtain using FUMA. You can find it [here](https://fuma.ctglab.nl/tutorial#snp2gene).

There's little we can write here, since it depends a lot on the outcome and the objetive of the functional annotation. The only "standardize" practice would be to look at the **Genomic Risk Loci** and the **Mapped Genes** and construct a table with the most crucial information to every significant signal that we obtained. We can also look at the regional plots generated by FUMA to check which are the **LeadSNPs** and the nearest genes. However, the LeadSNP, typically the SNP with the lowest *p*-value, does not need to be always the **causative SNP**. To determine which of the associated SNPs is the causative SNP we need to perform an independent [fine-mapping](https://github.com/cdiazmun/metadownGWAS/tree/main/fine-mapping) strategy. With FUMA, we obtain the genomic coordinates that we need for fine-mapping and also the list of mapped genes we will use to perform downstream analysis, such as [gene set enrichment analysis](https://github.com/cdiazmun/metadownGWAS/tree/main/gsea). 

## FUMA pipeline
1.  **Upload input file**

Input files should be prepared in ASCII _.txt_ or, preferably, gzipped. Every row should contain the summary statistics for a single SNP. We typically use the column names from `GWASinspector`. 

2.  **Parameters for lead SNPs and candidate SNPs identification**

The default settings are to perform identification of independent genome-wide significant SNPs at r2 = 0.6 and lead SNPs at r2 = 0.1, and to map SNPs to genes up to 10kb apart. Be aware of using the correct ancestry. Note that variants that do not exist in the selected reference panel will not be included in any analyses, so you always have to double-check that the nr of loci identified by FUMA is the same you can detect by manual inspection of GWAS summary stats.

3.1.  **Positional mapping**

Positional mapping is based on ANNOVAR annotations by specifying the maximum distance between SNPs and genes or based on functional consequences of SNPs on genes. We perform annotation based on DISTANCE. I usually don't apply any filter.

3.2.  **eQTL mapping**

Select the desired databases and tissue types to perform expression-quantitative trait loci (eQTL). These are genes that have a differential expression that is associated to a genome-wide significant variant from our GWAS meta-analysis. To avoid including too many "noisy signals", I usually select only results passing FDR correction (0.05). I usually don't apply any further filter.

3.3.  **Chromatin interaction mapping**

Select the desired databases and annotations. To avoid including too many "noisy signals", I usually select only results passing FDR correction (1E-06). I usually don't apply any further filter.

4.  **Gene types**

Select the gene types of interest. Be aware that this will impact a lot your results. If you're only interested in protein coding genes, then I would select only this gene type, as other non-coding genes can inflate a lot the number of mapped genes and, therefore, your downstream analysis. In any case, one can later on download the whole list of genes mapped by FUMA and filter them based on the type of gene or the kind of mapping used. Thus, another possibility is to just include everything and manually remove the undesired items in a subsequent step.

5.  **MHC region**

The major histocompatibility complex (MHC) region is a highly complex genomic region in terms of linkage disequilibrium (LD) that spans a distance of about 5 Mbp. Thus, a single signal located in this region can be mapped to hundreds of genes just because of the high LD pattern. However, the biological meaning of having all those genes mapped is not straightforward and can lead to misinterpretation of the signals associated to your trait. Because of that, you should consider excluding it. Nevertheless, you can also filter out later on the results as mentioned above. 

How to manually remove the genes mapped to the MHC region:
-  We will use the region delimitation indicated by FUMA, _i.e.,_ the genomic region between _MOG_ and _COL11A2_ genes. In practice, this is from base pair 29,624,779 to 33,160,276. Use this to remove positionally mapped genes.
-  We will keep eQTL-mapped genes to the MHC region.

6. **MAGMA analysis**

Perform MAGMA analysis. I typically select GTEx v8 tissue types for gene expression analysis.

